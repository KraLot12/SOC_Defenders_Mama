
```sql
SecurityAlert
| where AlertName contains "Email reported by user as malware or phish"
| summarize arg_max(TimeGenerated,*) by SystemAlertId
| mv-expand todynamic(Entities)
| where tostring(Entities.Type) in ("mailMessage")
| project TimeGenerated, AlertName, AlertSeverity, Description, VendorOriginalId, StartTime, EndTime, AlertLink, 
    P1Sender=tostring(Entities.P1Sender), 
    P1SenderDomain=tostring(Entities.P1SenderDomain), 
    P2Sender=tostring(Entities.P2Sender), 
    P2SenderDisplayName=tostring(Entities.P2SenderDisplayName), 
    P2SenderDomain=tostring(Entities.P2SenderDomain), 
    Recipient=tostring(Entities.Recipient), 
    SenderIP=tostring(Entities.SenderIP), 
    Subject=tostring(Entities.Subject), 
    Urls=tostring(Entities.Urls), 
    Files=tostring(Entities.Files), 
    AuthDetails=tostring(Entities.AuthDetails), 
    InternetMessageId=tostring(Entities.InternetMessageId), 
    OriginalDeliveryLocation=tostring(Entities.OriginalDeliveryLocation), 
    MailLanguage=tostring(Entities.Language), SystemAlertId
| join (SecurityAlert
      | where AlertName contains "Email reported by user as malware or phish"
      | summarize arg_max(TimeGenerated,*) by SystemAlertId
      | mv-expand todynamic(Entities)
      | where tostring(Entities.Type) in ("mailbox")
| project MailboxPrimaryAddress=tostring(Entities.MailboxPrimaryAddress), Upn=tostring(Entities.Upn), SystemAlertId) on SystemAlertId
| project-away SystemAlertId1
```

